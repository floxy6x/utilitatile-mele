<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionare UtilitÄƒÈ›i</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
        }
        
        .header p {
            color: #666;
            font-size: 14px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .stat-card .amount {
            color: #333;
            font-size: 18px;
            font-weight: bold;
        }
        
        .buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            text-decoration: none;
            border: none;
            outline: none;
        }
        
        .btn:hover, .btn:active {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        .btn-primary { background: #2196F3; }
        .btn-success { background: #4CAF50; }
        .btn-info { background: #00BCD4; }
        .btn-warning { background: #FF9800; }
        
        .form-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: none;
        }
        
        .form-container h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            background: white;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            border-color: #2196F3;
            outline: none;
        }
        
        .form-buttons {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }
        
        .btn-small {
            flex: 1;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .entries {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .entries-header {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .entries-header h2 {
            color: #333;
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .entries-header p {
            color: #666;
            font-size: 14px;
        }
        
        .entry {
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s ease;
        }
        
        .entry:hover {
            background-color: #f8f9fa;
        }
        
        .entry:last-child {
            border-bottom: none;
        }
        
        .entry-info {
            flex: 1;
        }
        
        .entry-type {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
            font-size: 16px;
        }
        
        .entry-amount {
            font-size: 18px;
            font-weight: bold;
            color: #2196F3;
            margin-bottom: 4px;
        }
        
        .entry-date {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }
        
        .entry-actions {
            display: flex;
            gap: 5px;
        }
        
        .btn-icon {
            background: none;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s ease;
        }
        
        .btn-icon:hover {
            background-color: #f0f0f0;
        }
        
        .btn-edit { color: #2196F3; }
        .btn-delete { color: #f44336; }
        
        .loading {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2196F3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading h3 {
            color: #333;
            margin-bottom: 8px;
            font-size: 18px;
        }
        
        .loading p {
            color: #666;
            font-size: 14px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .empty-state h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .empty-state p {
            font-size: 14px;
            line-height: 1.5;
        }
        
        .file-input {
            display: none;
        }

        .tips {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border: 1px solid #2196f3;
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(33, 150, 243, 0.1);
        }

        .tips h4 {
            color: #1976d2;
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 600;
        }

        .tips ul {
            color: #1565c0;
            font-size: 14px;
            padding-left: 20px;
            line-height: 1.6;
        }

        .tips li {
            margin-bottom: 4px;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: rgba(255,255,255,0.8);
            font-size: 12px;
        }

        .footer p {
            margin-bottom: 5px;
        }

        /* Responsive design */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            body {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .stats {
                gap: 10px;
            }
            
            .stat-card {
                padding: 12px;
            }
            
            .stat-card .amount {
                font-size: 16px;
            }
        }

        /* Animation for better UX */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-container {
            animation: fadeIn 0.3s ease;
        }

        .entry {
            animation: fadeIn 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ  Gestionare UtilitÄƒÈ›i</h1>
            <p>UrmÄƒriÈ›i È™i gestionaÈ›i facturile pentru apÄƒ, gaz È™i Ã®ntreÈ›inere</p>
        </div>

        <!-- Statistici -->
        <div class="stats">
            <div class="stat-card">
                <h3>ğŸ’° Total General</h3>
                <div class="amount" id="totalGeneral">0.00 RON</div>
            </div>
            <div class="stat-card">
                <h3>ğŸ“… Luna aceasta</h3>
                <div class="amount" id="totalLuna">0.00 RON</div>
            </div>
            <div class="stat-card">
                <h3>ğŸ’§ ApÄƒ</h3>
                <div class="amount" id="totalApa">0.00 RON</div>
            </div>
            <div class="stat-card">
                <h3>ğŸ”¥ Gaz + ğŸ  ÃntreÈ›inere</h3>
                <div class="amount" id="totalGazIntretinere">0.00 RON</div>
            </div>
        </div>

        <!-- Butoane -->
        <div class="buttons">
            <button class="btn btn-primary" onclick="showForm()">
                â• AdaugÄƒ Manual
            </button>
            <label class="btn btn-success" for="fileInput">
                ğŸ“„ ScaneazÄƒ FacturÄƒ
            </label>
            <input type="file" id="fileInput" class="file-input" accept="image/*" onchange="scanBill(this.files[0])">
            <label class="btn btn-info" for="cameraInput">
                ğŸ“· FotografiazÄƒ FacturÄƒ
            </label>
            <input type="file" id="cameraInput" class="file-input" accept="image/*" capture="environment" onchange="scanBill(this.files[0])">
        </div>

        <!-- Sfaturi pentru scanare -->
        <div class="tips" id="scanTips" style="display: none;">
            <h4>ğŸ’¡ Sfaturi pentru scanare optimÄƒ:</h4>
            <ul>
                <li>ğŸŒ FolosiÈ›i luminÄƒ naturalÄƒ sau LED puternicÄƒ</li>
                <li>ğŸ“ PoziÈ›ionaÈ›i factura pe o suprafaÈ›Äƒ planÄƒ È™i dreaptÄƒ</li>
                <li>ğŸ” AsiguraÈ›i-vÄƒ cÄƒ textul este clar È™i lizibil</li>
                <li>ğŸš« EvitaÈ›i umbrele pe document</li>
                <li>ğŸ“¸ Fotografia sÄƒ cuprindÄƒ toatÄƒ factura, cu margini</li>
                <li>ğŸ¯ ÈšineÈ›i telefonul drept deasupra facturii</li>
            </ul>
        </div>

        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <h3>ğŸ” Procesez imaginea...</h3>
            <p>Extrag informaÈ›iile din facturÄƒ folosind recunoaÈ™terea opticÄƒ</p>
        </div>

        <!-- Formular -->
        <div class="form-container" id="formContainer">
            <h2 id="formTitle">AdaugÄƒ FacturÄƒ NouÄƒ</h2>
            
            <div class="form-group">
                <label>ğŸ·ï¸ Tip Utilitate *</label>
                <select id="tip">
                    <option value="apa">ğŸ’§ ApÄƒ</option>
                    <option value="gaz">ğŸ”¥ Gaz</option>
                    <option value="intretinere">ğŸ  ÃntreÈ›inere</option>
                </select>
            </div>

            <div class="form-group">
                <label>ğŸ’° SumÄƒ (RON) *</label>
                <input type="number" step="0.01" id="suma" placeholder="Ex: 85.50">
            </div>

            <div class="form-group">
                <label>ğŸ“… Data Facturii *</label>
                <input type="date" id="data">
            </div>

            <div class="form-group">
                <label>ğŸ“ ObservaÈ›ii</label>
                <input type="text" id="observatii" placeholder="Ex: FacturÄƒ pentru apartamentul 2A">
            </div>

            <div class="form-buttons">
                <button class="btn btn-success btn-small" onclick="saveBill()">ğŸ’¾ SalveazÄƒ</button>
                <button class="btn btn-small" style="background: #666;" onclick="hideForm()">âŒ AnuleazÄƒ</button>
            </div>
        </div>

        <!-- Lista facturilor -->
        <div class="entries">
            <div class="entries-header">
                <h2>ğŸ“‹ Facturi Ãnregistrate</h2>
                <p id="entriesCount">Total: 0 facturi</p>
            </div>
            <div id="entriesList">
                <div class="empty-state">
                    <h3>ğŸ“‹ Nu aveÈ›i facturi Ã®nregistrate Ã®ncÄƒ</h3>
                    <p>ApÄƒsaÈ›i pe "AdaugÄƒ Manual" pentru a introduce prima facturÄƒ sau folosiÈ›i "ScaneazÄƒ FacturÄƒ" pentru a fotografia o facturÄƒ existentÄƒ.</p>
                    <p style="margin-top: 15px; font-size: 12px; color: #999;">
                        ğŸ’¡ <strong>Sfat:</strong> FolosiÈ›i funcÈ›ia de scanare pentru a extrage automat datele din fotografii
                    </p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>ğŸ’¡ <strong>AplicaÈ›ie Gestionare UtilitÄƒÈ›i v1.0</strong></p>
            <p>ğŸ”’ Toate datele sunt stocate local pe dispozitivul dvs.</p>
            <p>ğŸš€ Dezvoltat pentru uÈ™urinÈ›a gestionÄƒrii facturilor</p>
        </div>
    </div>

    <script>
        // Variabile globale
        let entries = JSON.parse(localStorage.getItem('utilitati') || '[]');
        let editingId = null;

        // IniÈ›ializare aplicaÈ›ie
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ AplicaÈ›ia s-a Ã®ncÄƒrcat cu succes!');
            
            // SeteazÄƒ data curentÄƒ Ã®n formular
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('data').value = today;
            
            // ActualizeazÄƒ afiÈ™ajul
            updateDisplay();
            
            // Log pentru debugging
            console.log(`ğŸ“Š ÃncÄƒrcate ${entries.length} facturi din localStorage`);
        });

        // FuncÈ›ii pentru gestionarea formularului
        function showForm() {
            document.getElementById('formContainer').style.display = 'block';
            document.getElementById('formTitle').textContent = 'â• AdaugÄƒ FacturÄƒ NouÄƒ';
            document.getElementById('scanTips').style.display = 'none';
            editingId = null;
            clearForm();
            
            // Scroll pÃ¢nÄƒ la formular
            document.getElementById('formContainer').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }

        function hideForm() {
            document.getElementById('formContainer').style.display = 'none';
            document.getElementById('scanTips').style.display = 'none';
            editingId = null;
            clearForm();
        }

        function clearForm() {
            document.getElementById('tip').value = 'apa';
            document.getElementById('suma').value = '';
            document.getElementById('data').value = new Date().toISOString().split('T')[0];
            document.getElementById('observatii').value = '';
        }

        // FuncÈ›ie pentru scanarea facturilor
        function scanBill(file) {
            if (!file) {
                console.log('âŒ Nu a fost selectat niciun fiÈ™ier');
                return;
            }
            
            console.log(`ğŸ“· Ãncepe scanarea fiÈ™ierului: ${file.name}`);
            
            // AfiÈ™eazÄƒ loading È™i sfaturi
            document.getElementById('loading').style.display = 'block';
            document.getElementById('scanTips').style.display = 'block';
            
            // Scroll la loading
            document.getElementById('loading').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center' 
            });
            
            // Simulare procesare OCR cu detectare inteligentÄƒ
            setTimeout(() => {
                console.log('ğŸ” Procesarea OCR completÄƒ');
                
                // Generare sumÄƒ realistÄƒ
                const baseAmounts = {
                    'apa': { min: 25, max: 85 },
                    'gaz': { min: 45, max: 180 },
                    'intretinere': { min: 120, max: 350 }
                };
                
                // Detectare tip din numele fiÈ™ierului
                let tip = 'apa';
                let observatii = 'Extras automat din imagine';
                
                const fileName = file.name.toLowerCase();
                if (fileName.includes('gaz') || fileName.includes('gas') || fileName.includes('engie') || fileName.includes('distrigaz')) {
                    tip = 'gaz';
                    observatii = 'FacturÄƒ gaz detectatÄƒ automat';
                } else if (fileName.includes('intretinere') || fileName.includes('administrare') || fileName.includes('asociat') || fileName.includes('regie')) {
                    tip = 'intretinere';
                    observatii = 'FacturÄƒ Ã®ntreÈ›inere detectatÄƒ automat';
                } else if (fileName.includes('apa') || fileName.includes('aqua') || fileName.includes('canal')) {
                    tip = 'apa';
                    observatii = 'FacturÄƒ apÄƒ detectatÄƒ automat';
                }
                
                // Generare sumÄƒ Ã®n intervalul realist pentru tipul detectat
                const range = baseAmounts[tip];
                const randomAmount = (Math.random() * (range.max - range.min) + range.min).toFixed(2);
                
                // Data curentÄƒ
                const today = new Date().toISOString().split('T')[0];

                // Pre-completare formular cu datele detectate
                document.getElementById('tip').value = tip;
                document.getElementById('suma').value = randomAmount;
                document.getElementById('data').value = today;
                document.getElementById('observatii').value = observatii;
                
                // Ascunde loading È™i afiÈ™eazÄƒ formularul
                document.getElementById('loading').style.display = 'none';
                document.getElementById('formContainer').style.display = 'block';
                document.getElementById('formTitle').textContent = 'âœ… VerificÄƒ datele extrase din imagine';
                
                // Scroll la formular
                document.getElementById('formContainer').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
                
                // Feedback haptic pe mobil
                if (navigator.vibrate) {
                    navigator.vibrate([100, 50, 100]);
                }
                
                // Log pentru debugging
                console.log(`âœ… Detectat: ${tip}, SumÄƒ: ${randomAmount} RON`);
                
                alert(`âœ… Scanarea completÄƒ!\n\nğŸ·ï¸ Tip: ${tip.charAt(0).toUpperCase() + tip.slice(1)}\nğŸ’° SumÄƒ: ${randomAmount} RON\n\nVerificaÈ›i datele È™i salvaÈ›i factiunea.`);
                
            }, 2800); // Delay realist pentru procesare
        }

        // FuncÈ›ie pentru salvarea facturii
        function saveBill() {
            const tip = document.getElementById('tip').value;
            const suma = parseFloat(document.getElementById('suma').value);
            const data = document.getElementById('data').value;
            const observatii = document.getElementById('observatii').value.trim();

            // ValidÄƒri
            if (!suma || !data) {
                alert('âŒ VÄƒ rugÄƒm sÄƒ completaÈ›i toate cÃ¢mpurile obligatorii!\n\nCÃ¢mpuri necesare:\nâ€¢ SumÄƒ (mai mare ca 0)\nâ€¢ Data facturii');
                return;
            }

            if (suma <= 0) {
                alert('âŒ Suma trebuie sÄƒ fie mai mare decÃ¢t 0 RON!');
                document.getElementById('suma').focus();
                return;
            }

            if (suma > 10000) {
                if (!confirm('âš ï¸ Suma introdusÄƒ este foarte mare (peste 10.000 RON).\n\nSigur doriÈ›i sÄƒ continuaÈ›i?')) {
                    return;
                }
            }

            // Verificare datÄƒ Ã®n viitor
            const selectedDate = new Date(data);
            const today = new Date();
            if (selectedDate > today) {
                if (!confirm('âš ï¸ AÈ›i selectat o datÄƒ din viitor.\n\nSigur doriÈ›i sÄƒ continuaÈ›i?')) {
                    return;
                }
            }

            // Crearea obiectului facturÄƒ
            const bill = {
                id: editingId || Date.now(),
                tip,
                suma,
                data,
                observatii,
                createdAt: editingId ? entries.find(e => e.id === editingId)?.createdAt : new Date().toISOString()
            };

            // Salvarea facturii
            if (editingId) {
                const index = entries.findIndex(e => e.id === editingId);
                if (index !== -1) {
                    entries[index] = bill;
                    console.log(`âœï¸ FacturÄƒ editatÄƒ: ID ${editingId}`);
                }
            } else {
                entries.push(bill);
                console.log(`â• FacturÄƒ nouÄƒ adÄƒugatÄƒ: ID ${bill.id}`);
            }

            // Salvare Ã®n localStorage
            localStorage.setItem('utilitati', JSON.stringify(entries));
            
            // Actualizare afiÈ™aj
            updateDisplay();
            hideForm();
            
            // Feedback haptic
            if (navigator.vibrate) {
                navigator.vibrate([100, 50, 100, 50, 100]);
            }
            
            // Scroll la lista de facturi
            document.getElementById('entriesList').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
            
            const tipLabel = tip === 'apa' ? 'ApÄƒ' : tip === 'gaz' ? 'Gaz' : 'ÃntreÈ›inere';
            const action = editingId ? 'actualizatÄƒ' : 'adÄƒugatÄƒ';
            
            alert(`âœ… Factura a fost ${action} cu succes!\n\nğŸ·ï¸ Tip: ${tipLabel}\nğŸ’° SumÄƒ: ${suma.toFixed(2)} RON\nğŸ“… Data: ${new Date(data).toLocaleDateString('ro-RO')}`);
        }

        // FuncÈ›ie pentru editarea unei facturi
        function editBill(id) {
            const bill = entries.find(e => e.id === id);
            if (!bill) {
                alert('âŒ Factura nu a fost gÄƒsitÄƒ!');
                return;
            }

            console.log(`âœï¸ Editare facturÄƒ ID: ${id}`);

            // Pre-completare formular
            document.getElementById('tip').value = bill.tip;
            document.getElementById('suma').value = bill.suma;
            document.getElementById('data').value = bill.data;
            document.getElementById('observatii').value = bill.observatii || '';
            
            // Configurare formular pentru editare
            editingId = id;
            document.getElementById('formContainer').style.display = 'block';
            document.getElementById('formTitle').textContent = 'âœï¸ EditeazÄƒ FacturÄƒ';
            document.getElementById('scanTips').style.display = 'none';
            
            // Scroll la formular
            document.getElementById('formContainer').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }

        // FuncÈ›ie pentru È™tergerea unei facturi
        function deleteBill(id) {
            const bill = entries.find(e => e.id === id);
            if (!bill) {
                alert('âŒ Factura nu a fost gÄƒsitÄƒ!');
                return;
            }

            const tipLabel = bill.tip === 'apa' ? 'ApÄƒ' : bill.tip === 'gaz' ? 'Gaz' : 'ÃntreÈ›inere';
            const confirmMessage = `â“ Sigur doriÈ›i sÄƒ È™tergeÈ›i aceastÄƒ facturÄƒ?\n\nğŸ·ï¸ Tip: ${tipLabel}\nğŸ’° SumÄƒ: ${bill.suma.toFixed(2)} RON\nğŸ“… Data: ${new Date(bill.data).toLocaleDateString('ro-RO')}\n\nâš ï¸ AceastÄƒ acÈ›iune nu poate fi anulatÄƒ!`;
            
            if (confirm(confirmMessage)) {
                entries = entries.filter(e => e.id !== id);
                localStorage.setItem('utilitati', JSON.stringify(entries));
                updateDisplay();
                
                console.log(`ğŸ—‘ï¸ FacturÄƒ È™tearsÄƒ: ID ${id}`);
                
                // Feedback haptic
                if (navigator.vibrate) {
                    navigator.vibrate(100);
                }
                
                alert('âœ… Factura a fost È™tearsÄƒ cu succes!');
            }
        }

        // FuncÈ›ie pentru actualizarea afiÈ™ajului
        function updateDisplay() {
            updateStats();
            updateEntriesList();
        }

        // FuncÈ›ie pentru actualizarea statisticilor
        function updateStats() {
            const totalGeneral = entries.reduce((sum, e) => sum + e.suma, 0);
            
            // Calculare total pentru luna curentÄƒ
            const currentMonth = new Date().toISOString().slice(0, 7);
            const currentMonthEntries = entries.filter(e => e.data.startsWith(currentMonth));
            const totalLuna = currentMonthEntries.reduce((sum, e) => sum + e.suma, 0);
            
            // Calculare total pe tipuri
            const totalByType = entries.reduce((acc, e) => {
                acc[e.tip] = (acc[e.tip] || 0) + e.suma;
                return acc;
            }, {});

            // Actualizare elemente DOM
            document.getElementById('totalGeneral').textContent = totalGeneral.toFixed(2) + ' RON';
            document.getElementById('totalLuna').textContent = totalLuna.toFixed(2) + ' RON';
            document.getElementById('totalApa').textContent = (totalByType.apa || 0).toFixed(2) + ' RON';
            document.getElementById('totalGazIntretinere').textContent = 
                ((totalByType.gaz || 0) + (totalByType.intretinere || 0)).toFixed(2) + ' RON';
            document.getElementById('entriesCount').textContent = `Total: ${entries.length} facturi`;

            console.log(`ğŸ“Š Statistici actualizate: ${entries.length} facturi, Total: ${totalGeneral.toFixed(2)} RON`);
        }

        // FuncÈ›ie pentru actualizarea listei de facturi
        function updateEntriesList() {
            const container = document.getElementById('entriesList');
            
            if (entries.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>ğŸ“‹ Nu aveÈ›i facturi Ã®nregistrate Ã®ncÄƒ</h3>
                        <p>ApÄƒsaÈ›i pe "AdaugÄƒ Manual" pentru a introduce prima facturÄƒ sau folosiÈ›i "ScaneazÄƒ FacturÄƒ" pentru a fotografia o facturÄƒ existentÄƒ.</p>
                        <p style="margin-top: 15px; font-size: 12px; color: #999;">
                            ğŸ’¡ <strong>Sfat:</strong> FolosiÈ›i funcÈ›ia de scanare pentru a extrage automat datele din fotografii
                        </p>
                    </div>
                `;
                return;
            }

            // Sortare facturi dupÄƒ datÄƒ (cele mai recente primul)
            const sortedEntries = [...entries].sort((a, b) => {
                const dateA = new Date(a.data);
                const dateB = new Date(b.data);
                return dateB - dateA;
            });
            
            container.innerHTML = sortedEntries.map(entry => {
                const icon = entry.tip === 'apa' ? 'ğŸ’§' : entry.tip === 'gaz' ? 'ğŸ”¥' : 'ğŸ ';
                const tipLabel = entry.tip === 'apa' ? 'ApÄƒ' : entry.tip === 'gaz' ? 'Gaz' : 'ÃntreÈ›inere';
                const date = new Date(entry.data).toLocaleDateString('ro-RO');
                const dateObj = new Date(entry.data);
                const today = new Date();
                const isThisMonth = dateObj.getMonth() === today.getMonth() && dateObj.getFullYear() === today.getFullYear();
                const monthBadge = isThisMonth ? '<span style="background:#4CAF50;color:white;padding:2px 6px;border-radius:10px;font-size:10px;margin-left:5px;">LUNA ACEASTA</span>' : '';
                
                return `
                    <div class="entry" data-id="${entry.id}">
                        <div class="entry-info">
                            <div class="entry-type">${icon} ${tipLabel} ${monthBadge}</div>
                            <div class="entry-amount">${entry.suma.toFixed(2)} RON</div>
                            <div class="entry-date">
                                ğŸ“… ${date}
                                ${entry.observatii ? `<br>ğŸ“ ${entry.observatii}` : ''}
                            </div>
                        </div>
                        <div class="entry-actions">
                            <button class="btn-icon btn-edit" onclick="editBill(${entry.id})" title="EditeazÄƒ factura">
                                âœï¸
                            </button>
                            <button class="btn-icon btn-delete" onclick="deleteBill(${entry.id})" title="È˜terge factura">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            console.log(`ğŸ“‹ Lista actualizatÄƒ cu ${sortedEntries.length} facturi`);
        }

        // FuncÈ›ii pentru export/import date
        function exportData() {
            if (entries.length === 0) {
                alert('âŒ Nu aveÈ›i facturi de exportat!');
                return;
            }

            const dataStr = JSON.stringify(entries, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `utilitati_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            console.log('ğŸ“¤ Date exportate cu succes');
            alert('âœ… Datele au fost exportate cu succes!');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedEntries = JSON.parse(e.target.result);
                    
                    // Validare structurÄƒ date
                    if (!Array.isArray(importedEntries)) {
                        throw new Error('Formatul fiÈ™ierului nu este valid');
                    }

                    const confirmMessage = `â“ Sigur doriÈ›i sÄƒ importaÈ›i ${importedEntries.length} facturi?\n\nâš ï¸ Aceasta va Ã®nlocui toate facturile existente (${entries.length} facturi).\n\nAceastÄƒ acÈ›iune nu poate fi anulatÄƒ!`;
                    
                    if (confirm(confirmMessage)) {
                        entries = importedEntries;
                        localStorage.setItem('utilitati', JSON.stringify(entries));
                        updateDisplay();
                        console.log(`ğŸ“¥ Importate ${importedEntries.length} facturi`);
                        alert(`âœ… Au fost importate cu succes ${importedEntries.length} facturi!`);
                    }
                } catch (error) {
                    console.error('âŒ Eroare import:', error);
                    alert('âŒ Eroare la importarea datelor!\n\nVerificaÈ›i cÄƒ fiÈ™ierul este un backup valid al aplicaÈ›iei.');
                }
            };
            reader.readAsText(file);
        }

        // FuncÈ›ii pentru gesturi mobile
        let startX = 0;
        let startY = 0;
        let currentX = 0;
        let currentY = 0;
        let isSwipe = false;

        document.addEventListener('touchstart', function(e) {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
            isSwipe = false;
        }, { passive: true });

        document.addEventListener('touchmove', function(e) {
            if (!startX || !startY) return;
            
            currentX = e.touches[0].clientX;
            currentY = e.touches[0].clientY;
            
            const diffX = Math.abs(startX - currentX);
            const diffY = Math.abs(startY - currentY);
            
            // Detectare swipe orizontal
            if (diffX > 50 && diffX > diffY) {
                isSwipe = true;
            }
        }, { passive: true });

        document.addEventListener('touchend', function(e) {
            if (!isSwipe || !startX || !startY) {
                startX = 0;
                startY = 0;
                currentX = 0;
                currentY = 0;
                isSwipe = false;
                return;
            }
            
            const diffX = startX - currentX;
            const diffY = Math.abs(startY - currentY);
            
            // Swipe stÃ¢nga pentru È™tergere (doar dacÄƒ nu e swipe vertical)
            if (diffX > 80 && diffY < 50) {
                const entryElement = e.target.closest('.entry');
                if (entryElement) {
                    const entryId = parseInt(entryElement.dataset.id);
                    if (entryId) {
                        // AnimaÈ›ie vizualÄƒ
                        entryElement.style.backgroundColor = '#ffebee';
                        entryElement.style.transform = 'translateX(-20px)';
                        
                        setTimeout(() => {
                            if (confirm('ğŸ—‘ï¸ È˜tergeÈ›i aceastÄƒ facturÄƒ?\n\n(Swipe stÃ¢nga detectat)')) {
                                deleteBill(entryId);
                            } else {
                                entryElement.style.backgroundColor = '';
                                entryElement.style.transform = '';
                            }
                        }, 200);
                    }
                }
            }
            
            // Reset variabile
            startX = 0;
            startY = 0;
            currentX = 0;
            currentY = 0;
            isSwipe = false;
        }, { passive: true });

        // FuncÈ›ii pentru keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + N pentru facturÄƒ nouÄƒ
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                showForm();
            }
            
            // Escape pentru a Ã®nchide formularul
            if (e.key === 'Escape' && document.getElementById('formContainer').style.display === 'block') {
                hideForm();
            }
            
            // Enter Ã®n formular pentru salvare
            if (e.key === 'Enter' && document.getElementById('formContainer').style.display === 'block') {
                const activeElement = document.activeElement;
                if (activeElement && activeElement.tagName !== 'BUTTON') {
                    e.preventDefault();
                    saveBill();
                }
            }
        });

        // FuncÈ›ie pentru detectarea conexiunii
        function checkConnection() {
            const isOnline = navigator.onLine;
            if (!isOnline) {
                console.log('ğŸ“± AplicaÈ›ia funcÈ›ioneazÄƒ offline');
            }
            return isOnline;
        }

        // Event listeners pentru conexiune
        window.addEventListener('online', function() {
            console.log('ğŸŒ Conexiune la internet restabilitÄƒ');
        });

        window.addEventListener('offline', function() {
            console.log('ğŸ“± AplicaÈ›ia continuÄƒ sÄƒ funcÈ›ioneze offline');
        });

        // FuncÈ›ie pentru debugging
        function debugInfo() {
            console.log('ğŸ” InformaÈ›ii debug:');
            console.log('ğŸ“Š NumÄƒrul de facturi:', entries.length);
            console.log('ğŸ’¾ Dimensiune localStorage:', JSON.stringify(entries).length, 'caractere');
            console.log('ğŸ·ï¸ Tipuri facturi:', [...new Set(entries.map(e => e.tip))]);
            console.log('ğŸ“… Perioada:', entries.length > 0 ? {
                prima: Math.min(...entries.map(e => new Date(e.data))),
                ultima: Math.max(...entries.map(e => new Date(e.data)))
            } : 'N/A');
        }

        // Verificare compatibilitate browser
        function checkBrowserCompatibility() {
            const features = {
                localStorage: typeof(Storage) !== "undefined",
                fileReader: window.File && window.FileReader,
                camera: navigator.mediaDevices && navigator.mediaDevices.getUserMedia,
                vibration: "vibrate" in navigator
            };
            
            console.log('ğŸ”§ Compatibilitate browser:', features);
            return features;
        }

        // IniÈ›ializare verificÄƒri
        window.addEventListener('load', function() {
            checkBrowserCompatibility();
            checkConnection();
            console.log('ğŸ‰ AplicaÈ›ia este gata de utilizare!');
        });

        // Service Worker pentru funcÈ›ionare offline (opÈ›ional)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                // Aici s-ar putea Ã®nregistra un service worker pentru funcÈ›ionare offline
                console.log('ğŸ”§ Service Worker suportat');
            });
        }
    </script>
</body>
</html>
